/** 
* rogue - v2.5.0.
* git://github.com/mkay581/rogue.git
* Copyright 2015 Mark Kennedy. Licensed MIT.
*/
"use strict";var ResourceManager=require("resource-manager"),request=require("request"),Promise=require("promise"),path=require("path"),_currentRoutePromise,Router=function(a){return this.options=a||{},this};Router.prototype={start:function(){this._pages={},this._history=[],this._fetchConfig(this.options.config).then(function(a){this._config=a,this.triggerRoute(window.location.pathname),window.addEventListener("popstate",this._getRouteRequestListener())}.bind(this))},_fetchConfig:function(a){return a||console.error("RouteManager error: no configuration data was supplied."),new Promise(function(b){return"string"==typeof a?request(a):void b(a)})},_getRouteRequestListener:function(){return function(){return this._onRouteRequest.bind(this)}},reset:function(){this._history=[],this._pages={}},stop:function(){window.removeEventListener("popstate",this._getRouteRequestListener())},triggerRoute:function(a){return history.pushState({path:a},document.title,a),_currentRoutePromise=new Promise},goBack:function(a){a?window.history.go(a):window.history.back()},goForward:function(a){a?window.history.go(a):window.history.forward()},getRelativeUrlParams:function(){return this.getRelativeUrl().split("/")||[]},getRelativeUrl:function(){return this._currentPath||window.location.hash.replace("#","")},getHistory:function(){return this._history},_storeHistory:function(a){this._history.push({path:a[0]})},_onRouteRequest:function(a){a!==this._currentPath&&this._loadPage(a).then(function(a){return a.show().then(_currentRoutePromise.resolve)})["catch"](_currentRoutePromise.reject)},_loadPage:function(a){var b=this._currentPath,c=this.options.config[a],d=c.css||[];return b&&this._pages[b]&&this._pages[b].hide(),this._currentPath=a,ResourceManager.loadCss(d).then(function(){return ResourceManager.loadTemplate(c.template).then(function(){this._pages[c.url]=require(c.script)}.bind(this))}.bind(this))}},module.exports=function(a){return new Router(a)};