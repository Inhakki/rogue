!function(a){"use strict";"function"==typeof define&&define.amd?define(["underscore","element-kit"],function(b){return a(b)}):a(window._)}(function(a){"use strict";var b=function(a,b,c){var d,e,f=a.length;for(d=0;f>d;d++)e=a[d],e.kit[b].apply(e.kit,c)},c=function(a){this.initialize(a)};c.prototype={initialize:function(b){this.options=a.extend({el:null,showEvent:null,hideEvent:null,onShow:null,onHide:null,cssPrefix:"ui-tooltip"},b),this.prefix=this.options.cssPrefix,this.activeClass=this.prefix+"-active",this.el=this.options.el,this.trigger=this.el.getElementsByClassName(this.prefix+"-trigger")[0],this.setup()},setup:function(){var a=this.options;a.showEvent&&(this.eventMap=this._setupEvents(a.showEvent,a.hideEvent))},_setupEvents:function(a,b){var c,d,e=this._buildEventMap(a,b);for(c in e)e.hasOwnProperty(c)&&(d=e[c],this.trigger.addEventListener(d.name,d.event));return e},_onDuplicateEvent:function(){this.isActive()?this.hide():this.show()},_buildEventMap:function(a,b){var c={};return a===b?(c.showEvent={name:a,event:this._onDuplicateEvent.bind(this)},c):(a&&(c.showEvent={name:a,event:this.show.bind(this)}),b&&(c.hideEvent={name:b,event:this.hide.bind(this)}),c)},show:function(){this.el.kit.classList.add(this.activeClass),this.options.onShow&&this.options.onShow()},hide:function(){this.el.kit.classList.remove(this.activeClass),this.options.onHide&&this.options.onHide()},isActive:function(){return this.el.kit.classList.contains(this.activeClass)},destroy:function(){var a,b,c=this.eventMap;if(c)for(a in c)c.hasOwnProperty(a)&&(b=c[a],this.trigger.removeEventListener(b.name,b.event))}};var d=function(a){this.initialize(a)};d.prototype={initialize:function(b){this.options=a.extend({containerEl:document.getElementsByTagName("body")[0],el:null,onHide:null,onShow:null,onClickOutside:this.hide.bind(this),activeClass:"modal-active",containerActiveClass:"modal-container-active"},b),this.container=this.options.containerEl,this.content=this.options.el},setup:function(){this.container.contains(this.content)||this.container.appendChild(this.content)},show:function(){this.setup(),this.content.kit.classList.add(this.options.activeClass),document.addEventListener("click",this._onDocClick.bind(this),!0),this.container.kit.classList.add(this.options.containerActiveClass),this.options.onShow&&this.options.onShow()},hide:function(){this.content.kit.classList.remove(this.options.activeClass),document.removeEventListener("click",this._onDocClick.bind(this),!0),this.container.getElementsByClassName(this.options.activeClass).length||this.container.kit.classList.remove(this.options.containerActiveClass),this.options.onHide&&this.options.onHide()},isActive:function(){return this.content.classList.contains(this.options.activeClass)},_onDocClick:function(a){var b=a.target,c=!this.content.contains(b);c&&this.isActive()&&this.options.onClickOutside&&this.options.onClickOutside()},destroy:function(){this.content.kit.classList.remove(this.options.activeClass),this.container.contains(this.content)&&this.container.removeChild(this.content),this.container.getElementsByClassName(this.options.activeClass).length||this.container.kit.classList.remove(this.options.containerActiveClass),document.removeEventListener("click",this._onDocClick.bind(this),!0)}};var e={setValue:function(a,b,c,d){d=d||this._getCallback(arguments),this._delegateMethod(localStorage,"setItem",a,b,d),c&&this._setupFlushTime(a,c)},getValue:function(a,b){return this._delegateMethod(localStorage,"getItem",a,null,b)},flushValue:function(a,b){this._delegateMethod(localStorage,"removeItem",a,null,b)},setSessionValue:function(a,b,c){this._delegateMethod(sessionStorage,"setItem",a,b,c)},getSessionValue:function(a,b){return this._delegateMethod(sessionStorage,"getItem",a,null,b)},flushSessionValue:function(a,b){this._delegateMethod(sessionStorage,"removeItem",a,null,b)},_setupFlushTime:function(a,b){this.timers=this.timers||{},this.timers[a]=setTimeout(function(){this.flushValue.call(this,a,function(){clearTimeout(this.timers[a])}.bind(this))}.bind(this),b)},_getCallback:function(){return"function"==typeof arguments[arguments.length-1]?arguments[arguments.length-1]:null},_delegateMethod:function(a,b,c,d,e){return"getItem"===b||"getItem"===b?d=a[b](c):d?a[b](c,d):a[b](c),e&&e(d),d},_constructErrorMessage:function(a){return"CacheManager error: "+a},cacheData:function(a,b){this.setValue(a,b)},getCacheData:function(a){return this.getValue(a)},flushData:function(a){this.flushValue(a)}},f=function(a){this.initialize(a)};f.prototype={initialize:function(b){this.options=a.extend({thumbnails:[],thumbnailActiveTriggerEvent:"click",thumbnailActiveClass:"carousel-thumbnail-active",onChange:null},b),this.setup()},setup:function(){var a=this.options.thumbnails;a.length&&b(a,"addEventListener",[this.options.thumbnailActiveTriggerEvent,"onThumbnailEvent",this])},onThumbnailEvent:function(a){this._thumbnailArr||(this._thumbnailArr=Array.prototype.slice.call(this.options.thumbnails));var b=this._thumbnailArr.indexOf(a.currentTarget);-1!==b&&b!==this.getCurrentIndex()&&this.options.onChange&&this.options.onChange(b)},_checkForInitErrors:function(){var a=this.options,b=a.thumbnails.length;b||console.error("carousel error: no thumbnails were passed in constructor")},goTo:function(a){var b=this.options.thumbnails,c=this.getCurrentIndex()||0,d=this.options.thumbnailActiveClass;b.length&&(b[a].kit.classList.add(d),c!==a&&b[c].kit.classList.remove(d),this._currentIndex=a)},getCurrentIndex:function(){return this._currentIndex},destroy:function(){var a=this.options,c=a.thumbnails;this._currentIndex=null,c.length&&b(c,"removeEventListener",[a.thumbnailActiveTriggerEvent,"onThumbnailEvent",this])}};var g=function(a){this.initialize(a)};return g.prototype={initialize:function(b){this.options=a.extend({panels:[],assetClass:null,assetLoadingClass:"carousel-asset-loading",autoLoadAssets:!0,panelActiveClass:"carousel-panel-active",onPanelChange:null,lazyLoadAttr:"data-src",thumbnails:[],thumbnailActiveTriggerEvent:"click",thumbnailActiveClass:"carousel-thumbnail-active",initialIndex:0},b),this._checkForInitErrors(),this.setup(),"number"==typeof this.options.initialIndex&&this.goToPanel(this.options.initialIndex)},setup:function(){var a=this.options;a.onChange=this.goToPanel.bind(this),this.thumbnails=new f(a)},_checkForInitErrors:function(){var a=this.options,b=a.panels.length,c=a.thumbnails.length;b||console.error("carousel error: no panels were passed in constructor"),c&&c!==b&&console.warn("carousel warning: number of thumbnails passed in constructor do not equal the number of panels\npanels: "+b+"\nthumbnails: "+c+"\n")},goToPanel:function(a){var b=this.options.panels.length-1,c=0,d=this.getCurrentIndex();a>b?a=c:c>a&&(a=b),(void 0===d||d!==a)&&(this._updatePanels(a),this.thumbnails.goTo(a),this._currentIndex=a,this.options.onPanelChange&&this.options.onPanelChange(a))},_updatePanels:function(a){var b=this.options.panels,c=this.getCurrentIndex();void 0!==c&&b[c].kit.classList.remove(this.options.panelActiveClass),b[a].kit.classList.add(this.options.panelActiveClass),this.options.autoLoadAssets&&this.loadPanelAssets(a)},getCurrentIndex:function(){return this._currentIndex},loadPanelAssets:function(a){var b,c,d=this.options.panels[a],e=this.options.assetClass?d.getElementsByClassName(this.options.assetClass):[d],f=e.length;for(b=0;f>b;b++)c=e[b],c.getAttribute(this.options.lazyLoadAttr)&&("img"===c.tagName.toLowerCase()?this._loadImageAsset(c):console.warn("carousel error: no matching img elements to lazy load. try supplying a valid assetClass option to constructor"))},_loadImageAsset:function(a,b){var c=new Image,d=a.getAttribute(this.options.lazyLoadAttr),e=this.options.assetLoadingClass;a.kit.classList.add(e),c.onload=function(){a.src=d,a.kit.classList.remove(e),b?b():null},c.src=d},destroy:function(){var a=this.options;a.panels[this.getCurrentIndex()].kit.classList.remove(a.panelActiveClass),this._currentIndex=null,this.thumbnails.destroy()}},{CacheManager:e,Tooltip:c,Modal:d,Carousel:g}});